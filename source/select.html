<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='UIFactory-Select'>/**
</span> * @class  UIFactory.Select
 * @author  Flavio De Stefano &lt;flavio.destefano@caffeinalab.com&gt;
 */

var Moment = require(&#39;T/ext/moment&#39;);

function createTiUIPicker(args) {
	var pickerArgs = {};
	var pickerType = (function(){
		if (args.type === &#39;date&#39;) return Ti.UI.PICKER_TYPE_DATE;
		return Ti.UI.PICKER_TYPE_PLAIN;
	})();

	if (OS_IOS) {
		pickerArgs = _.extend(_.pick(args, &#39;minDate&#39;, &#39;maxDate&#39;), {
			height: 216,
			bottom: 0,
			type: pickerType
		});
	} else if (OS_ANDROID) {
		pickerArgs = _.extend(_.omit(args, &#39;values&#39;, &#39;type&#39;));
	}

	var $picker = null;

	if (args.type === &#39;date&#39;) {

		pickerArgs.theValue = args.theValue || new Date();
		pickerArgs.value = pickerArgs.theValue;

		if (OS_IOS) {

			$picker = Ti.UI.createPicker(pickerArgs);
			$picker.addEventListener(&#39;change&#39;, function(e) {
				$picker.theValue = e.value;
			});

		} else if (OS_ANDROID) {

			$picker = Ti.UI.createLabel(_.extend(pickerArgs, {
				text: Moment(pickerArgs.theValue).format(&#39;D MMMM YYYY&#39;)
			}));

			$picker.addEventListener(&#39;click&#39;, function(){
				Ti.UI.createPicker({ type: Ti.UI.PICKER_TYPE_DATE }).showDatePickerDialog({
					value: $picker.theValue,
					callback: function(e) {
						if (e.value != null &amp;&amp; e.cancel === false) {
							$picker.theValue = e.value;
							$picker.text = Moment($picker.theValue).format(&#39;D MMMM YYYY&#39;);
						}
					}
				});
			});

		}

	} else {

		$picker = Ti.UI.createPicker(pickerArgs);
		var selectedRowIndex = 0;

<span id='UIFactory-Select-property-values'>		/**
</span>		 * @property values
		 * An array containing the values.
		 *
		 * You can specify an entry like `{ value: &#39;1&#39;, title: &#39;One&#39; }` to define different title/values,
		 * or simply `1` for the sames.
		 * @type {Array}
		 */
		$picker.add(_.map(args.values, function(v, index) {
			var $pickerRow = null;
			if (_.isObject(v) &amp;&amp; v.value !== undefined) {
				$pickerRow = Ti.UI.createPickerRow(v);
				if (args.theValue === v.value) selectedRowIndex = +index;
			} else {
				$pickerRow = Ti.UI.createPickerRow({ title: v.toString(), value: v });
				if (args.theValue === v) selectedRowIndex = +index;
			}
			return $pickerRow;
		}));

		$picker.setSelectedRow(0, selectedRowIndex, false);
		$picker.addEventListener(&#39;change&#39;, function(e) {
			$picker.theRow = e.row;

<span id='UIFactory-Select-property-theValue'>			/**
</span>			 * @property theValue
			 * Value of the picker
			 * @type {Object}
			 */
			$picker.theValue = e.row.value;
		});

	}

	return $picker;
}

module.exports = function(args) {
	args = args || {};
	var $this = null;

	if (OS_IOS) {

		$this = Ti.UI.createLabel(args);

		// Function that open the Picker modal window
		$this.showPicker = function() {
			var $pickerModal = Ti.UI.createWindow({ backgroundColor: &#39;transparent&#39; });
			var $pickerModalView = Ti.UI.createView({
				height: 216 + 50,
				width: Ti.UI.FILL,
				bottom: 0,
				transform: Ti.UI.create2DMatrix().translate(0, 216+50)
			});
			var $picker = createTiUIPicker($this);

			var $doneBtn = Ti.UI.createButton({ title: L(&#39;Done&#39;), style: Ti.UI.iPhone.SystemButtonStyle.DONE });
			$doneBtn.addEventListener(&#39;click&#39;, function() {
				if (args.type === &#39;date&#39;) {
					$this.text = Moment($picker.theValue).format(&#39;D MMMM YYYY&#39;);
				} else {
					$this.text = $picker.theRow.title;
				}
				$this.theValue = $picker.theValue;
				$pickerModal.close();
			});

			var $cancelBtn = Ti.UI.createButton({ systemButton: Ti.UI.iPhone.SystemButton.CANCEL });
			$cancelBtn.addEventListener(&#39;click&#39;, function() {
				$pickerModal.close();
			});

			$pickerModalView.add(Ti.UI.iOS.createToolbar({
				items: [ $cancelBtn, Ti.UI.createButton({ systemButton: Ti.UI.iPhone.SystemButton.FLEXIBLE_SPACE }), $doneBtn ],
				bottom: 216,
				borderTop: true,
				borderBottom: false
			}));

			$pickerModalView.add($picker);
			$pickerModal.add($pickerModalView);

			$pickerModal.open();
			$pickerModalView.animate({ transform: Ti.UI.create2DMatrix() });
		};

		// Trigger modal on click
		$this.addEventListener(&#39;click&#39;, $this.showPicker);

	} else if (OS_ANDROID) {

		$this = createTiUIPicker(args);

	}

<span id='UIFactory-Select-method-getValue'>	/**
</span>	 * @method getValue
	 * Get the value
	 * @return {Object}
	 */
	$this.getValue = function() {
		return $this.theValue;
	};

	return $this;
};
</pre>
</body>
</html>
